import{r as i,j as e,D as h,R as x,c as D}from"./index-Dmv_TXKJ.js";const w="collapse.mode",g=s=>`/fancybuild_clean/${s}`,b=()=>{if(typeof window>"u")return"hub";const s=window.location.hash.replace(/^#\/?/,""),[t,n]=s.split(/[\/?]/);return t==="player"?n==="ops"?"player-ops":"player":t==="gm"?n==="ops"?"gm-ops":"gm":t==="chud"?"chud":t==="csmatrix"?"csmatrix":"hub"},E=()=>{if(typeof window>"u")return"player";const s=window.localStorage.getItem(w),t=b();return t==="gm"||t==="gm-ops"?"gm":t==="player"||t==="player-ops"||t==="chud"||t==="csmatrix"?"player":s??"player"},C=({title:s,src:t,onBack:n,note:a,actions:o,actionsClassName:d,frameRef:f,onFrameLoad:c})=>e.jsxs("main",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn ghost-btn-icon",onClick:n,"aria-label":"Back to hub",children:e.jsx("span",{"aria-hidden":"true",children:"←"})}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:s})]}),o?e.jsx("div",{className:d||"topbar-actions",children:o}):null]}),e.jsx("div",{className:"subapp-frame",children:e.jsx("iframe",{title:s,src:t,ref:f,onLoad:c,style:{border:"none"},allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-pointer-lock"})})]}),k=({onBack:s,children:t,chudDock:n})=>{const a=()=>{typeof window<"u"&&window.dispatchEvent(new Event("chud-open"))};return e.jsxs("div",{className:"player-shell",style:{minHeight:"100vh",background:"var(--bg-dark)"},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn ghost-btn-icon",onClick:s,"aria-label":"Back to hub",children:e.jsx("span",{"aria-hidden":"true",children:"←"})}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse Full Build"}),e.jsx("strong",{children:"Collapse Companion"})]}),e.jsx("div",{className:"topbar-actions",children:e.jsx("button",{className:"chud-top-btn",onClick:a,"aria-label":"Open cHUD overlay",children:"cHUD"})})]}),n,t]})},N=({onBack:s,children:t,chudDock:n,style:a})=>{const o=()=>{typeof window<"u"&&window.dispatchEvent(new Event("chud-open"))};return e.jsxs("div",{className:"gm-shell",style:{minHeight:"100vh",background:"var(--bg-dark)",...a},children:[e.jsxs("header",{className:"topbar",children:[e.jsx("button",{className:"ghost-btn ghost-btn-icon",onClick:s,"aria-label":"Back to hub",children:e.jsx("span",{"aria-hidden":"true",children:"←"})}),e.jsxs("div",{className:"topbar-title",children:[e.jsx("div",{className:"muted",style:{fontSize:"0.85rem"},children:"Collapse GM Companion"}),e.jsx("strong",{children:"GM Tools"})]}),e.jsx("div",{className:"topbar-actions",children:e.jsx("button",{className:"chud-top-btn",onClick:o,"aria-label":"Open cHUD overlay",children:"cHUD"})})]}),n,t]})},M=({eyebrow:s,title:t,description:n,helper:a})=>e.jsx("div",{className:"page",children:e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",style:{fontSize:"0.9rem",textTransform:"uppercase",letterSpacing:"0.08em"},children:s}),e.jsx("h1",{style:{margin:"0.15rem 0 0.35rem 0"},children:t}),e.jsx("p",{className:"muted",style:{margin:0},children:n})]}),a&&e.jsx("div",{className:"muted text-body",style:{maxWidth:320,textAlign:"right"},children:a})]})}),B=({basePath:s})=>{const[t,n]=x.useState(!1);return x.useEffect(()=>{const a=()=>n(!0);return window.addEventListener("chud-open",a),()=>window.removeEventListener("chud-open",a)},[]),e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"chud-fab",onClick:()=>n(!0),"aria-label":"Open cHUD overlay",children:"cHUD"}),t&&e.jsx("div",{className:"chud-overlay",role:"dialog","aria-modal":"true","aria-label":"cHUD overlay",children:e.jsxs("div",{className:"chud-sheet",children:[e.jsxs("div",{className:"chud-sheet-header",children:[e.jsx("span",{children:"cHUD"}),e.jsx("button",{className:"chud-close",onClick:()=>n(!1),"aria-label":"Close cHUD",children:"✕"})]}),e.jsx("div",{className:"chud-sheet-body",children:e.jsx("iframe",{title:"cHUD",src:`${s}chud/index.html`,allow:"fullscreen",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-pointer-lock"})})]})})]})},H=({mode:s,onModeChange:t,onNavigate:n})=>{const a=i.useMemo(()=>[{id:"player",title:"Deck Builder",description:"Player-facing tools with deck builder and ops.",audience:"player"},{id:"player-ops",title:"Deck Ops",description:"Standalone deck operations for the player deck.",audience:"player"},{id:"gm",title:"Companion — GM",description:"GM-only deck tools with pure counts.",audience:"gm",subtitle:"GM"},{id:"gm-ops",title:"Deck Ops — GM",description:"Standalone deck operations for the GM deck.",audience:"gm",subtitle:"GM"},{id:"csmatrix",title:"CS Matrix",description:"Campaign Support Matrix with draggable nodes.",audience:"player"},{id:"chud",title:"cHUD",description:"Compact HUD for derived stats.",audience:"player"}].filter(d=>d.audience===s),[s]);return e.jsx("main",{className:"hub-landing",children:e.jsxs("div",{className:"hub-landing-content",style:{width:"min(1100px, 100%)",padding:"1.25rem 1rem"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:`mode-toggle ${s==="player"?"active":""}`,onClick:()=>t("player"),"aria-pressed":s==="player",children:"Player"}),e.jsx("button",{className:`mode-toggle ${s==="gm"?"active":""}`,onClick:()=>t("gm"),"aria-pressed":s==="gm",children:"GM"})]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem",marginTop:"1.1rem"},children:a.map(o=>e.jsxs("button",{style:{border:"1px solid var(--border)",borderRadius:16,padding:"1rem",background:"var(--surface)",minHeight:126,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"0.5rem",textAlign:"center",cursor:"pointer"},onClick:()=>n(o.id),children:[e.jsx("h2",{style:{margin:0},children:o.title}),o.subtitle?e.jsx("span",{style:{color:"var(--muted)",fontSize:"0.9rem"},children:o.subtitle}):null,e.jsx("p",{style:{color:"var(--muted)",margin:"0.25rem 0"},children:o.description})]},o.id))})]})})};function G(){const[s,t]=i.useState(()=>b()),[n,a]=i.useState(()=>E()),o=i.useRef(null),[d,f]=i.useState({controlsOpen:!1,nodesOpen:!1}),c=s!=="chud"?e.jsx(B,{basePath:g("")}):null;i.useEffect(()=>{const r=()=>{const l=b();if(t(l),l==="gm"||l==="gm-ops")a("gm");else if(l==="player"||l==="player-ops")a("player");else{const u=typeof window<"u"?window.localStorage.getItem(w):null;u&&a(u)}};return r(),window.addEventListener("hashchange",r),window.addEventListener("popstate",r),()=>{window.removeEventListener("hashchange",r),window.removeEventListener("popstate",r)}},[]),i.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(w,n)},[n]),i.useEffect(()=>{if(typeof window>"u")return;const r=window.location.origin&&window.location.origin!=="null"?window.location.origin:"*",l=u=>{if(r!=="*"&&u.origin!==r)return;const p=u.data;!p||p.type!=="collapse-csmatrix-state"||f({controlsOpen:!!p.controlsOpen,nodesOpen:!!p.nodesOpen})};return window.addEventListener("message",l),()=>window.removeEventListener("message",l)},[]);const m=i.useCallback(r=>{var p;if(typeof window>"u")return;const l=(p=o.current)==null?void 0:p.contentWindow;if(!l)return;const u=window.location.origin&&window.location.origin!=="null"?window.location.origin:"*";l.postMessage({target:"csmatrix",action:r},u)},[]),O=i.useCallback(()=>{m("request-state")},[m]);i.useEffect(()=>{if(typeof window>"u")return;const r=(()=>{switch(s){case"player":return"#/player";case"player-ops":return"#/player/ops";case"gm":return"#/gm";case"gm-ops":return"#/gm/ops";case"chud":return"#/chud";case"csmatrix":return"#/csmatrix";default:return"#/hub"}})();window.location.hash!==r&&(window.location.hash=r)},[s]);const y=i.useMemo(()=>[{id:"gm-base-1",name:"Base",type:"Base"}],[]),j=i.useMemo(()=>[{id:"gm-mod-1",name:"Mod",type:"Modifier",cost:1}],[]),v=i.useMemo(()=>({id:"gm-null",name:"Null",type:"Null"}),[]);return s==="player"?e.jsx(k,{onBack:()=>t("hub"),chudDock:c,children:e.jsx(h,{showOpsSections:!1,showModifierCards:!0,showModifierCardCounter:!1,showModifierCapacity:!0,showBaseCounters:!0,showBaseAdjusters:!1})}):s==="player-ops"?e.jsx(k,{onBack:()=>t("hub"),chudDock:c,children:e.jsx(h,{storageKey:"collapse.deck-builder.v2",showBuilderSections:!1,showOpsSections:!0,lockControlsInOps:!1})}):s==="gm"?e.jsxs(N,{onBack:()=>t("hub"),chudDock:c,children:[e.jsx(M,{eyebrow:"GM Companion",title:"GM Deck & Table Tools",description:"Pure-count GM deck controls with offline storage, separate from player data.",helper:"Use this to prep encounters, lock decks, and keep the GM pool isolated."}),e.jsx(h,{storageKey:"collapse.deck-builder.gm.v1",exportPrefix:"collapse-gm-deck",baseCardsOverride:y,modCardsOverride:j,nullCardOverride:v,baseTarget:15,minNulls:5,modifierCapacityDefault:10,showCardDetails:!1,simpleCounters:!0,modCapacityAsCount:!0,showOpsSections:!1,showModifierCards:!0,showModifierCapacity:!1})]}):s==="gm-ops"?e.jsxs(N,{onBack:()=>t("hub"),chudDock:c,children:[e.jsx(M,{eyebrow:"GM Deck Ops",title:"Operational View",description:"Minimal deck operations for live sessions, keeping the GM pool locked and quick to reach.",helper:"Builder sections stay hidden; use the dock to draw, shuffle, and manage discard."}),e.jsx(h,{storageKey:"collapse.deck-builder.gm.v1",exportPrefix:"collapse-gm-deck",baseCardsOverride:y,modCardsOverride:j,nullCardOverride:v,baseTarget:15,minNulls:5,modifierCapacityDefault:10,showCardDetails:!1,simpleCounters:!0,modCapacityAsCount:!0,showBuilderSections:!1,showOpsSections:!0,lockControlsInOps:!1})]}):s==="chud"?e.jsx(C,{title:"cHUD — Compact HUD",src:`${g("")}chud/index.html`,onBack:()=>t("hub"),note:"Loaded inside the fullbuild shell."}):s==="csmatrix"?e.jsx(C,{title:"CS Matrix",src:g("csmatrix/index.html"),onBack:()=>t("hub"),note:"Campaign Support Matrix (in-app iframe).",actionsClassName:"topbar-actions topbar-actions-stack",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"topbar-pill",onClick:()=>m("toggle-controls"),"aria-pressed":d.controlsOpen,children:d.controlsOpen?"Hide Controls":"Show Controls"}),e.jsx("button",{className:"topbar-pill",onClick:()=>m("toggle-nodes"),"aria-pressed":d.nodesOpen,children:d.nodesOpen?"Hide Nodes":"Show Nodes"})]}),frameRef:o,onFrameLoad:O}):e.jsxs(e.Fragment,{children:[c,e.jsx(H,{mode:n,onModeChange:r=>{a(r),t("hub")},onNavigate:r=>{t(r),a(r==="gm"||r==="gm-ops"?"gm":"player")}})]})}const S=document.getElementById("root");if(!S)throw new Error("Root element #root not found");D.createRoot(S).render(e.jsx(x.StrictMode,{children:e.jsx(G,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/fancybuild_clean/sw.js").catch(t=>{console.error("Service worker registration failed",t)})});if(typeof window<"u")try{new URLSearchParams(window.location.search).get("debug")==="overflow"&&document.documentElement.classList.add("debug-overflow")}catch{}
