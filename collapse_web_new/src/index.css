/* Page header styles for responsive design */
.page-header {
  /* Inline styles used in code were replaced by a class to make responsive rules clearer */
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  text-align: center;
}
@media (max-width: 840px) {
  .page-header { flex-direction: column; align-items: center; text-align: center; }
}

/* Compact card: reduced paddings and less pronounced border for nested/summary sections */
.card.compact {
  padding: var(--gap-1) !important;
  border-radius: 8px !important;
  border: 1px solid rgba(34,34,34,0.75) !important;
  background: rgba(8,8,8,0.85) !important;
}
@media (max-width: 840px) {
  .card.compact { padding: 8px !important; border: none !important; background: transparent !important; }
}

:root {
  /* Design tokens for compact mobile-first layout */
  font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: #f8f9fa;
  background-color: var(--bg-dark);
  font-size: 14px;
  --topbar-height: 64px;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  background:
    radial-gradient(120% 120% at 10% 10%, rgba(74, 116, 255, 0.12), transparent 40%),
    radial-gradient(120% 120% at 80% 0%, rgba(255, 99, 173, 0.12), transparent 40%),
    linear-gradient(180deg, #0d0d11 0%, #0a0a0f 60%, #050507 100%);
  color: inherit;
}

/* Prevent visual overflow of the viewport on mobile devices */
@media (max-width: 840px) {
  html, body, #root { max-width: 100vw; overflow-x: hidden; }
}
html, body, #root { height: 100%; }

/* Pager behavior: horizontal swiping via .pager-inner remains enabled on mobile; ensure page content still fits */

button {
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--bg-dark);
  color: inherit;
  padding: 0.28rem 0.6rem;
  cursor: pointer;
  font-size: 0.92rem;
}

button:hover {
  border-color: var(--accent);
}

/* Ghost button for navigation/back actions */
.ghost-btn {
  border-color: transparent;
  background: transparent;
  padding-left: 0;
  padding-right: 0.35rem;
}
.ghost-btn:hover {
  border-color: transparent;
  color: var(--accent);
}

.mode-toggle {
  border-radius: 999px;
  padding: 0.45rem 0.85rem;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.04);
  transition: border-color 160ms ease, background 160ms ease, color 160ms ease, box-shadow 160ms ease;
  font-weight: 600;
}
.mode-toggle.active {
  border-color: var(--accent);
  color: #eaf2ff;
  box-shadow: 0 0 0 1px rgba(86,141,255,0.35), 0 6px 16px rgba(0,0,0,0.35);
  background: linear-gradient(90deg, rgba(86,141,255,0.18), rgba(86,255,201,0.12));
}

.lock-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--border);
  font-size: 0.9rem;
  font-weight: 700;
}
.lock-pill.locked {
  background: rgba(255, 99, 132, 0.14);
  border-color: rgba(255, 99, 132, 0.55);
  color: #ffd8e0;
  animation: pulse-warning 1s ease-in-out 0s 30;
}
.lock-pill.unlocked {
  background: rgba(86,255,201,0.12);
  border-color: rgba(86,255,201,0.5);
  color: #dfffea;
}

.cta-pulse {
  animation: pulse-warning 1s ease-in-out infinite;
}

.ops-error {
  margin-top: 8px;
  color: #ffb3b3;
  font-weight: 700;
}

.topbar {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0.5rem 0.6rem;
  background: linear-gradient(180deg, rgba(12,12,12,0.96), rgba(12,12,12,0.9));
  border-bottom: 1px solid var(--separator);
  min-height: var(--topbar-height);
}
.topbar-title {
  display: flex;
  flex-direction: column;
  gap: 2px;
}
.topbar-actions {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 10px;
}
.chud-top-btn {
  border: none;
  padding: 8px 12px;
  border-radius: 999px;
  background: linear-gradient(135deg, rgba(86,141,255,0.9), rgba(86,255,201,0.8));
  color: #0b0d12;
  font-weight: 800;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(0,0,0,0.25);
}
.subapp-frame {
  flex: 1;
  min-height: calc(100vh - var(--topbar-height));
}
.subapp-frame iframe {
  display: block;
  width: 100%;
  height: calc(100vh - var(--topbar-height));
}

main {
  padding-bottom: 3rem;
}

.app-shell {
  width: 100%;
  max-width: 1100px;
  margin: 0 auto;
  padding: 0.8rem 0.9rem;
  display: flex;
  flex-direction: column;
  gap: 12px;
  box-sizing: border-box;
}
@media (min-width: 960px) {
  .app-shell {
    padding: 1rem;
  }
}

.ops-toolbar,
.ops-save {
  display: flex;
  gap: 8px;
  align-items: center;
}

.ops-toolbar {
  flex-wrap: wrap;
  width: 100%;
  justify-content: flex-start;
  margin-top: 8px;
}

.ops-save {
  flex-wrap: wrap;
  flex: 1 1 320px;
  margin-left: 0;
  width: 100%;
}

.ops-save input {
  flex: 1 1 180px;
  min-width: 0;
}

/* Pager and mobile-forward layout */
:root {
  --app-header-height: 7.5rem;
  --page-bleed: calc((100vw - 100%) / 2); /* adjust if header size changes */
}

.pager {
  width: 100%;
  overflow: hidden;
  position: relative;
  touch-action: pan-y;
}

.pager-inner {
  display: flex;
  flex-direction: row;
  transition: transform 320ms cubic-bezier(.2,.8,.2,1);
  will-change: transform;
}
.pager-inner { cursor: grab; }
.pager-inner:active { cursor: grabbing; }
.pager-inner.disable-pointer-events { pointer-events: none; }

.page {
  flex: 0 0 100%;
  width: 100%;
  max-width: 1100px;
  padding: clamp(16px, 4vw, 24px);
  margin: 0 auto;
  box-sizing: border-box;
  overflow-x: hidden;
}
.page-full-bleed {
  width: 100%;
  margin: 0 auto;
}

/* Make pages use viewport height and scroll internally on small screens so
   content doesn't force the page wider than the viewport. Adjust the
   subtraction value if your header or pager sizes change. */
.page {
  /* Allow natural flow to avoid nested scrolls; main page scroll only */
  min-height: auto;
  height: auto;
  max-height: none;
  overflow: visible;
}
.pager-nav {
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  margin: 0.5rem 0 1rem 0;
}
.pager-dot {
  width:10px;height:10px;border-radius:50%;background:#2a2a2a;opacity:0.5;
}
.pager-dot.active{background:#7b78ff;opacity:1;transform:scale(1.35);transition:transform 220ms}
.pager-dot{transition:transform 220ms, opacity 180ms}

.pager-item{display:flex;flex-direction:column;align-items:center;gap:6px;min-width:48px}
.pager-label{font-size:0.8rem;color:var(--muted)}
.pager-item[aria-current='true'] .pager-label{color:#7b78ff;font-weight:600}

/* Shared card grids */
.card-grid {
  display: grid;
  gap: 8px;
}

/* Compact grid variant: tighter gap and edge-to-edge content for dense lists */
.card-grid.compact { gap: var(--gap-small); padding: 0; background: transparent; border: none; }

/* Compact visual rules: prefer edge-to-edge lists in compact mode */
.card-grid.compact .card { border: none; background: transparent; border-radius: 0; padding: var(--gap-1) 0; }
.section.compact, section.compact { padding: var(--gap-1) 0; border: none; background: transparent; }
.card-grid.compact .card.base-card { padding: var(--gap-1) 0; }

.card-grid.base-card-grid {
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 8px;
}

.card-grid.mod-card-grid {
  grid-template-columns: repeat(auto-fit, minmax(215px, 1fr));
  justify-items: center;
}

/* Card-like containers */
.card {
  border:1px solid #333;
  border-radius:8px;
  padding: var(--gap-1);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.1));
  min-width: 0; /* allow grid children to shrink on mobile */
  word-break: break-word;
  overflow-wrap: anywhere;
  width: 100%;
  box-sizing: border-box;
  overflow-x: hidden; /* ensure card content cannot overflow horizontally */
  max-width: 100%;
}

.card * {
  min-width: 0; /* prevent child content (dd, dt, divs) from causing overflow */
}

/* Compact header and counter layout for card items */
.card-header { display:flex;align-items:center;justify-content:space-between;gap:6px;flex-wrap:nowrap }
.card-title {
  min-width: 0;
  flex: 1 1 auto;
  overflow: hidden;
}
.card-title .card-name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight:700; font-size: var(--type-section); }
.card.base-card .card-title .card-name {
  display: inline-block;
  white-space: nowrap;
  overflow: visible;
  text-overflow: clip;
  word-break: normal;
  max-width: 100%;
  font-size: clamp(0.95rem, 3.1vw, 1.1rem);
}
.card.base-card .card-title {
  max-width: 100%;
  overflow: visible;
  text-align: center;
  align-items: center;
  justify-content: center;
  width: 100%;
  gap: 6px;
}
.card.base-card .card-title .card-controls-bottom {
  width: 100%;
  justify-content: center;
  gap: 8px;
}
.card.base-card .card-body,
.card.base-card .card-header {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  text-align: center;
}
.card.base-card .card-title {
  text-align: center;
  align-items: center;
  justify-content: center;
  overflow: visible;
  width: 100%;
}
.card.base-card .card-name {
  white-space: normal !important;
  text-align: center;
  word-break: break-word;
  overflow: visible;
  text-overflow: clip;
  hyphens: auto;
  font-size: clamp(0.72rem, 2vw, 0.9rem);
  line-height: 1.12;
  padding: 0;
  width: 100%;
}
.card.base-card .counter-value {
  align-self: center;
  margin-left: 0;
  text-align: center;
}
.card.base-card .card-controls {
  justify-content: center;
}
.card.mod-card .card-header {
  align-items: flex-start;
}
.card.mod-card .card-title {
  align-items: flex-start;
  text-align: left;
}
.card-text {
  white-space: pre-wrap;
}
.card.mod-card .card-text {
  text-align: center;
  overflow: visible;
  white-space: normal;
  max-width: none;
  margin-top: 15px;
  margin-bottom: 15px;
}
.card.mod-card .card-details {
  grid-template-columns: 1fr;
  row-gap: 8px;
  width: 100%;
}
.card.mod-card .card-details dt,
.card.mod-card .card-details dd {
  grid-column: 1;
  white-space: normal;
  overflow: visible;
  text-overflow: clip;
  width: 100%;
}
.card.mod-card .card-name,
.card.mod-card .card-title,
.card.mod-card .card-body {
  white-space: normal;
  overflow: visible;
  text-overflow: clip;
  flex: 1 1 auto;
}

.card.mod-card .counter-pill {
  margin-left: auto;
}
.card.mod-card .target-line {
  margin-top: 2px;
}

.summary-stack {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  max-width: 420px;
  margin: 0 auto;
  text-align: center;
}
.summary-stack > div {
  width: 100%;
}
.summary-stack .counter-inline {
  justify-content: center;
}
.summary-stack .status-warning,
.summary-stack .status-error {
  text-align: center;
}

.play-overlay {
  margin-top: 12px;
  padding: 16px 14px 14px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(0,0,0,0.6);
  box-shadow: 0 12px 24px rgba(0,0,0,0.35), 0 0 0 1px rgba(255,255,255,0.04);
}
.play-overlay-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}
.play-overlay-title {
  font-weight: 700;
  font-size: 1.1rem;
}
.play-overlay-body {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 8px;
  margin-top: 8px;
}
.play-overlay-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.play-overlay-actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 10px;
}
.card.base-card .card-title {
  align-items: center;
  text-align: center;
}
.card-controls {
  display: flex;
  gap: 6px;
  align-items: center;
  flex: 0 0 auto;
}
.counter-btn { width: calc(var(--counter-size) * 1.2); height: calc(var(--counter-size) * 1.2); padding: 0; font-size: 1.08rem; }
.counter-value {
  min-width: 20px;
  text-align: center;
}

.counter-inline {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.counter-inline .counter-btn {
  width: 32px;
  height: 32px;
}
.counter-pill {
  min-width: 42px;
  padding: 2px 12px;
  text-align: center;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.05);
  font-weight: 600;
}

.hand-carousel {
  position: relative;
  /* Wider rail so the first/last cards peek past the visible area without clipping */
  --hand-bleed: clamp(32px, 8vw, 64px);
  --hand-pad-inline: clamp(22px, 6vw, 36px);
  --hand-pad-block-start: 12px;
  --hand-pad-block-end: 18px;
  width: 100vw;
  max-width: none;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
  padding: 0;
  overflow: visible; /* allow the peek */
}

.hand-track {
  display: flex;
  align-items: flex-end;
  gap: 12px;
  box-sizing: border-box;
  width: calc(100vw + (var(--hand-bleed) * 2));
  min-width: calc(100vw + (var(--hand-bleed) * 2));
  margin-left: calc(-1 * var(--hand-bleed));
  margin-right: calc(-1 * var(--hand-bleed));
  padding: var(--hand-pad-block-start) calc(var(--hand-pad-inline) + var(--hand-bleed)) var(--hand-pad-block-end);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
  scroll-padding-left: calc(var(--hand-pad-inline) + var(--hand-bleed) + 8px);
  scroll-padding-right: calc(var(--hand-pad-inline) + var(--hand-bleed) + 8px);
}
.hand-track::-webkit-scrollbar { height: 8px; }
.hand-track::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 999px; }

.hand-card {
  position: relative;
  flex: 0 0 286px;
  min-width: 286px;
  max-width: 286px;
  min-height: 360px;
  max-height: 360px;
  border: 1px solid rgba(255,255,255,0.16);
  border-radius: 12px;
  padding: 20px 16px 20px;
  background:
    radial-gradient(circle at 22% 18%, rgba(99, 153, 255, 0.14), rgba(0, 0, 0, 0.75) 58%),
    linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(0, 0, 0, 0.65));
  box-shadow: 0 12px 32px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.04);
  display: flex;
  flex-direction: column;
  gap: 10px;
  justify-content: space-between;
  scroll-snap-align: start;
  flex-shrink: 0;
}

.hand-content {
  display: flex;
  flex-direction: column;
  gap: 24px;
  padding-top: 8px;
  flex: 1;
  justify-content: space-between;
}

.hand-meta {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}
.hand-title {
  font-size: 1.15rem;
  font-weight: 600;
}
.hand-subtitle {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  font-size: 0.85rem;
  color: var(--muted);
}
.hand-subtitle .hand-pill { margin-left: 4px; }
.hand-type {
  text-transform: uppercase;
  letter-spacing: 0.04em;
  font-size: 0.72rem;
}
.hand-count {
  font-weight: 600;
}
.hand-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  margin-top: 8px;
  padding-top: 12px;
  width: 100%;
}
.hand-pill {
  padding: 2px 10px;
  border-radius: 999px;
  border: 1px solid var(--accent);
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.hand-hint {
  font-size: 0.8rem;
  color: var(--muted);
  margin-top: 6px;
}
.hand-text {
  display: flex;
  flex-direction: column;
  gap: 22px;
  flex: 1;
  line-height: 1.35;
}
.hand-text .effect-block {
  margin-bottom: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
  font-size: 0.88em;
  text-align: center;
  align-items: center;
  max-width: 85%;
  align-self: center;
}
.hand-text .effect-block .effect-line {
  font-size: 1.26em;
  margin: 0;
  overflow-wrap: anywhere;
  word-break: break-word;
}
.hand-text .meta-block {
  margin-top: auto;
  display: grid;
  grid-template-columns: auto 1fr;
  column-gap: 10px;
  row-gap: 6px;
}
.hand-text dl { margin: 0; }
.hand-text dt { font-weight: 700; }
.hand-text dd {
  margin: 0;
  overflow-wrap: anywhere;
  word-break: break-word;
}
.hand-text .target-line { margin-top: 2px; }

.hand-warning-overlay {
  position: absolute;
  inset: 8px;
  border-radius: 10px;
  background: rgba(0, 0, 0, 0.78);
  border: 1px solid rgba(255, 215, 96, 0.6);
  box-shadow: 0 12px 30px rgba(0,0,0,0.45), 0 0 18px rgba(255, 215, 96, 0.35);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 12px;
  gap: 10px;
  text-align: center;
  z-index: 5;
}
.hand-warning-text {
  font-size: 0.95rem;
  color: #ffeccc;
  line-height: 1.35;
}
.hand-warning-dismiss {
  border: 1px solid rgba(255, 215, 96, 0.7);
  background: rgba(255, 215, 96, 0.12);
  color: #ffeccc;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}
.hand-warning-dismiss:hover {
  border-color: rgba(255, 215, 96, 0.9);
  background: rgba(255, 215, 96, 0.2);
}

/* Ensure the header row of cards allows the left content to shrink and the right controls to remain anchored inside the border */
.card > div > div:first-child { min-width:0; flex: 1 1 auto; }
.card > div > div:last-child { flex: 0 0 auto; min-width:0; }
/* Prevent the left header content from growing too large and pushing action buttons beyond the right edge */
.card > div > div:first-child { max-width: calc(100% - 120px); }
@media (max-width: 520px) {
  .card > div > div:first-child { max-width: calc(100% - 96px); }
}
/* Ensure long header line wraps inside the left column to avoid pushing right controls out */
.card > div > div:first-child { overflow-wrap: anywhere; word-break: break-word; white-space: normal; }


.card.base-card, .card.mod-card {
  display: flex;
  flex-direction: column;
}
.card.mod-card {
  width: 215px;
  min-width: 215px;
  max-width: 215px;
  min-height: 281px;
  height: auto;
  word-break: normal;
  overflow-wrap: normal;
}
.card.mod-card > div > div:first-child {
  max-width: 100%;
}
.card.mod-card .card-title,
.card.mod-card .card-name,
.card.mod-card .card-body,
.card.mod-card .card-details,
.card.mod-card .card-text,
.card.mod-card .card-details dt,
.card.mod-card .card-details dd {
  white-space: normal;
  word-break: normal;
  overflow-wrap: normal;
}
.card-controls-bottom {
  justify-content: center;
  margin-top: auto;
  width: 100%;
  gap: 10px;
}
.card-controls-bottom .counter-value {
  font-weight: 700;
}

/* Base-card-specific header adjustments to ensure control buttons remain inside the card border */
.card-grid.base-card-grid .card > div { overflow: hidden; }
.card-grid.base-card-grid .card > div > div:last-child { display: flex; align-items: center; gap: 6px; flex: 0 0 auto; }
.card-grid.base-card-grid .card > div > div:last-child button { min-width: 28px; width: 28px; height: 28px; padding: 0; box-sizing: border-box; }
.card-grid.base-card-grid .card > div > div:last-child button svg, .card-grid.base-card-grid .card > div > div:last-child button span { display:block; width:100%; height:100%; }
.card-grid.base-card-grid .card { min-height: 84px; }


/* Selected / highlight state */
.card.is-selected { border-color: #7b78ff; box-shadow: none; }
/* Class-based sizing and padding rules for base and mod cards */
.card.base-card { padding: calc(var(--gap-1) + 2px) calc(var(--gap-2)); border-radius: 8px; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: manipulation; }
.card.mod-card { padding: calc(var(--gap-1) + 2px); border-radius: 8px; }
.card.small-card { padding: var(--gap-1); border-radius: 8px; }

/* Base-card header override for explicit scoping */
.card.base-card > div { overflow: hidden; }
.card.base-card > div > div:first-child { min-width: 0; flex: 1 1 auto; }
.card.base-card > div > div:last-child { flex: 0 0 auto; min-width: 0; margin-left: 12px; }

/* Debug class overlays element bounds: only visible when ?debug=overflow is set */
.debug-overflow * {
  outline: 1px dashed rgba(255,64,64,0.2);
}
.debug-overflow .card { outline: 2px solid rgba(255, 64, 64, 0.25); }

.card dl dt,
.card dl dd {
  overflow-wrap: anywhere;
  word-break: break-word;
  white-space: normal;
}

/* Compact font scaling for dense lists */
.card-grid.compact .card p, .card-grid.compact .card .card-details, .card-grid.compact .card .row-meta { font-size: var(--type-body); color: var(--muted); }

/* Utility text classes using centralized tokens */
.text-page { font-size: var(--type-page); }
.text-section { font-size: var(--type-section); }
.text-body { font-size: var(--type-body); }
.text-footnote { font-size: var(--type-footnote); }
.stat-large { font-size: var(--stat-large); font-weight: 700; }
.muted { color: var(--muted); }
.accent { color: var(--accent); }
.status-success { color: var(--success); }
.status-warning { color: var(--warning); }
.status-error { color: var(--error); }
.card-name { font-weight: 700; }
.weight-600 { font-weight: 600; }
.label-strong { font-weight: 600; font-size: var(--type-section); }

/* Details grid class; default layout uses two columns (label/value) */
.card-details { display: grid; grid-template-columns: auto 1fr; column-gap: 8px; row-gap: 4px; align-items: center; }
.card-details dt, .card-details dd { margin: 0; }
/* Keep two-column metadata layout even on narrow screens but keep label narrow and values flexible */
@media (max-width: 1400px) {
  .card-details { grid-template-columns: 120px 1fr; }
}

/* More aggressive stacking on phone-sized viewports to avoid label/value wide columns */
/* Keep two-column metadata in compact grids; switch to single column only if space is extreme */
@media (max-width: 1080px) {
  .card-details { grid-template-columns: 1fr; }
}

/* For compact card grids, prefer a tighter 2-column layout for metadata to maximize density */
.card-grid.compact .card-details { grid-template-columns: 1fr 1fr; column-gap: 6px; row-gap: 2px; }
@media (max-width: 520px) {
  .card-grid.compact .card-details { grid-template-columns: 1fr 1fr; }
}

/* Label column sizing: give dt a max width to prevent large left column from forcing horizontal layout */
.card dl dt { max-width: 120px; min-width: 56px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card dl dd { max-width: calc(100% - 140px); overflow: hidden; text-overflow: ellipsis; }

.card.mod-card .card-details dt,
.card.mod-card .card-details dd {
  max-width: 100%;
  min-width: 0;
  width: 100%;
  overflow: visible;
  text-overflow: clip;
}

/* Tighter label widths for base cards to reduce content wrap */
.card-grid.base-card-grid .card .card-details dt { max-width: 18%; min-width: 60px; }
.card-grid.base-card-grid .card .card-details dd { max-width: 82%; }

/* Ensure images and svgs do not overflow cards */
.card img, .card svg { max-width: 100%; height: auto; display: block; }

/* Mobile first adjustments */
@media (max-width: 840px) {
  .app-shell {
    width: 100%;
    max-width: 640px;
    padding: 0.5rem 0.75rem 6.5rem;
    box-sizing: border-box;
  }
  .card { padding:10px; }
  button { padding: 0.5rem 0.85rem; }
  main { padding: 0.5rem; }
  .card-grid.mod-card-grid { grid-template-columns: minmax(0, 1fr) !important; }
  .card-grid.base-card-grid .card { max-width: calc(100% - 16px); }
  .ops-save button,
  .ops-toolbar button {
    flex: 1 1 140px;
  }
  /* Sticky pager: mobile-first bottom nav that stays visible while interacting */
  .pager-nav {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    background: linear-gradient(180deg, rgba(0,0,0,0.85), rgba(0,0,0,0.95));
    padding: 10px 12px;
    margin: 0;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.5);
  }
  /* Ensure page content doesn't get covered by fixed pager */
  main { padding-bottom: 6.5rem; }
  /* Prevent any accidental horizontal overflow in page content */
  .page, .app-shell { overflow-x: hidden; }
  .page * { min-width: 0; max-width: 100%; }
}

/* Ensure consistent horizontal gutters on small/medium screens: rely on .page
   padding for consistent left/right spacing and remove app-shell horizontal
   padding which caused uneven left-side spacing. */
@media (max-width: 1080px) {
  .app-shell { padding-inline: 0 !important; }
  .page { padding-left: clamp(16px, 4vw, 24px) !important; padding-right: clamp(16px, 4vw, 24px) !important; }
}

/* Narrow phone-specific adjustments */
@media (max-width: 520px) {
  /* Always single column for modifiers; base cards keep two columns */
  .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  .card { padding: 8px 10px; }
  .app-shell { width: min(100%, 480px); }
}

/* More aggressive single-column enforcement for phones and larger phones in landscape */
@media (max-width: 980px) {
  .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  .app-shell { width: 100%; padding: 0.5rem; }
}

/* Stack labels/values into rows if the screen is narrow */
@media (max-width: 1400px) {
  .card dl { grid-template-columns: 1fr; grid-auto-flow: row; }
  .card dl dt { grid-column: 1; margin-top: 6px; }
  .card dl dd { grid-column: 1; margin-left: 0; }
  .card p, .card div, .card span { word-break: break-word; overflow-wrap: anywhere; }
  .card * { max-width: 100%; }
  .card-grid > * { width: 100%; min-width: 0; max-width: 100%; }
  .card button { min-width: 0; }
}

/* defensive mobile layout to guarantee no bleed on any phone width */
@media (max-width: 1400px) {
  html, body, #root, .app-shell, .page { max-width: 100vw !important; overflow-x: hidden !important; }
  .pager { overflow-x: hidden !important; }
  /* ensure page content clamps to viewport for any transform based pager */
  .page { max-width: calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right)); }
  /* Force single column for modifier cards */
  .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  /* shrink label column more on medium widths */
  .card dl dt { max-width: 20%; min-width: 56px; }
  .card dl dd { max-width: 80%; }
}

/* Increase page gutters for mobile to avoid edge glancing */
@media (max-width: 1080px) {
  .page { padding-left: clamp(16px, 4vw, 24px) !important; padding-right: clamp(16px, 4vw, 24px) !important; }
  .app-shell { padding-left: clamp(12px, 3vw, 20px) !important; padding-right: clamp(12px, 3vw, 20px) !important; }
  /* ensure card grid has internal gutters */
  .card-grid.base-card-grid { padding-left: 12px; padding-right: 12px; }
}

/* Target 1080x1920 and smaller devices (common Full HD mobile) */
@media (max-width: 1080px) {
  .app-shell { width: 100%; max-width: 1080px; padding: 0.75rem; }
  .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  .card { width: 100%; padding: 10px 12px; }
  h1 { font-size: clamp(1.6rem, 4vw, 2.4rem); }
  h2 { font-size: clamp(1.2rem, 3.5vw, 1.6rem); }
  .card dl dt { max-width: 28%; min-width: 70px; }
  .card dl dd { max-width: 72%; }
  .card p, .card dl, .card div { font-size: clamp(0.8rem, 2.4vw, 1rem); }
  .page, .app-shell { overflow-x: hidden; }
  .card { box-sizing: border-box; }
}

/* Add a little more right padding to keep action buttons comfortably inside card bounds */
@media (max-width: 1080px) {
  .card { padding-right: clamp(12px, 4vw, 20px) !important; }
  /* More aggressive right padding for base cards on mobile; include safe-area insets */
  .card.base-card { padding-inline-end: calc(clamp(18px, 6vw, 28px) + env(safe-area-inset-right, 0px)) !important; }
}

/* Extra padding on very narrow devices to ensure visual padding even when safe-area is limited */
@media (max-width: 420px) {
  .card.base-card { padding-inline-end: calc(22px + env(safe-area-inset-right, 0px)) !important; }
}

/* PWA (standalone) display mode often has different viewports and no browser chrome; add extra padding */
@media (display-mode: standalone) {
  .card.base-card { padding-inline-end: calc(22px + env(safe-area-inset-right, 0px)) !important; }
}

@media (max-width: 420px) and (display-mode: standalone) {
  .card.base-card { padding-inline-end: calc(28px + env(safe-area-inset-right, 0px)) !important; }
}

/* Ensure base card horizontal padding prevents edge touching on various phones */
@media (max-width: 1080px) {
  .card-grid.base-card-grid .card {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  /* Force label column restraint for base cards (override broader rules) */
  .card-grid.base-card-grid .card .card-details dt { max-width: 18% !important; min-width: 56px; }
  .card-grid.base-card-grid .card .card-details dd { max-width: 82% !important; }
}

/* Keep two-column base cards on small screens */
@media (max-width: 768px) {
  .card-grid.base-card-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
  }
}

/* Permanent horizontal pager: always position pages in a single row and move
  the track using a translateX transform controlled via the CSS variable
  `--pager-offset` (value in percentage, e.g. 0% or 100%). This keeps layout
  stable, performant and avoids scrollLeft-based movement. */
.pager-inner { transform: translateX(calc(-1 * var(--pager-offset, 0%))); }

/* defensive mobile layout: ensure pages are viewport-locked and cannot cause
  horizontal bleed. Keep this rule active for all sizes to make the horizontal
  layout permanent and predictable. */
html, body, #root { width: 100%; height: 100%; overflow-x: hidden; }

/* Make sure the pager nav (sticky bottom) doesn't cover page content by
  providing bottom padding via the main/app-shell when needed. */

/* Fallback for very small devices where Safari visual viewport might cause overflow: ensure card content fits by shrinking font and spacing */
@media (max-width: 400px) {
  .card { padding: 8px; }
  .card h3, .card h2, .card h1 { font-size: clamp(1rem, 4vw, 1.2rem) !important; }
  .card dl { font-size: 0.75rem; }
}

/* Reduce heading and large numeric font sizes on narrower screens to prevent overflow */
@media (max-width: 600px) {
  h1, h2, h3 { font-size: clamp(1rem, 3.5vw, 1.6rem); }
  .card .muted, .card p, .card dl { font-size: clamp(0.75rem, 2.6vw, 0.95rem); }
}

code {
  font-family: 'JetBrains Mono', 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
}

/* GM shell: disable nested scroll areas so only one scroll bar appears */
.gm-shell .pager {
  overflow: visible;
}
.gm-shell .page {
  height: auto;
  max-height: none;
  overflow: visible;
  padding-bottom: 2rem;
}

/* Deckbuilder styling enhancements */
.card {
  border-radius: 14px;
  box-shadow:
    0 10px 28px rgba(0,0,0,0.35),
    0 0 0 1px rgba(255,255,255,0.05);
  transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.06);
}
.card:hover {
  transform: translateY(-2px) scale(1.01);
  box-shadow: 0 12px 26px rgba(0,0,0,0.34), 0 0 0 1px rgba(255,255,255,0.04);
}
.card:active {
  transform: translateY(0) scale(0.99);
}
.card.base-card .card-header { background: none; }
.card.base-card {
  box-shadow:
    0 0 28px rgba(90, 180, 255, 0.75),
    0 12px 30px rgba(0, 0, 0, 0.38),
    0 0 0 1px rgba(120, 190, 255, 0.75),
    inset 0 0 0 1px rgba(120, 190, 255, 0.32);
  border: 1px solid rgba(120, 190, 255, 0.75);
  background: radial-gradient(circle at 40% 30%, rgba(120, 180, 255, 0.28), rgba(11, 14, 20, 0.9) 58%), #0b0e14;
}
.card.mod-card .card-header {
  background: linear-gradient(90deg, rgba(112, 255, 211, 0.12), transparent 60%);
}
.card.mod-card {
  box-shadow:
    0 12px 32px rgba(67, 217, 173, 0.30),
    0 0 30px rgba(67, 217, 173, 0.28),
    0 0 0 1px rgba(99, 240, 200, 0.35);
  line-height: 1.24;
  word-break: normal;
  overflow-wrap: normal;
  width: 215px;
  max-width: 215px;
  min-width: 215px;
  min-height: 281px;
  height: auto;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  gap: 6px;
  width: 100%;
}
.card.mod-card .card-details {
  grid-template-columns: 1fr;
  row-gap: 6px;
  margin-top: 15px;
}
.card.mod-card .card-details dt {
  margin-top: 0;
}
.card.mod-card .card-details dt:nth-of-type(2) {
  margin-top: 24px;
}
.card.mod-card .card-details dt:first-of-type + dd {
  font-size: 1.05em;
}
.card.mod-card .card-text {
  font-size: 1em;
}
.card.mod-card .card-details,
.card.mod-card .card-details dt,
.card.mod-card .card-details dd {
  font-size: 0.9em;
}
.card.mod-card .card-body {
  font-size: 1em;
}
.card.mod-card .card-details dd {
  padding-left: 8px;
  box-sizing: border-box;
}
.card.mod-card .card-body {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  gap: 4px;
  width: 100%;
}
.card.mod-card .card-title {
  overflow: visible;
  align-items: flex-start;
  text-align: left;
  white-space: normal;
  width: 100%;
}
.card.mod-card .card-name {
  white-space: normal !important;
  overflow: visible;
  text-overflow: clip;
  word-break: normal;
  overflow-wrap: normal;
}
.card.mod-card .card-body {
  flex: 1 1 auto;
  width: 100%;
}
.card.mod-card .card-details dt,
.card.mod-card .card-details dd {
  grid-column: 1;
  white-space: normal;
  overflow-wrap: normal;
}
.card .card-name {
  letter-spacing: 0.01em;
}

.capacity-reached {
  color: #ff8a8a;
  font-weight: 700;
  animation: pulse-warning 1s ease-in-out infinite;
  text-align: right;
  margin-top: 0;
}

@keyframes pulse-warning {
  0% { opacity: 0.45; }
  50% { opacity: 1; }
  100% { opacity: 0.45; }
}

.card-grid.carousel {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 16px;
  padding: 0;
  margin: 0 calc(50% - 50vw);
  scroll-snap-type: x mandatory;
}
.card-grid.carousel .card {
  min-width: 92%;
  max-width: 92%;
  min-height: 360px;
  padding: 14px;
  scroll-snap-align: start;
}
/* Base cards: show two per swipe with a shorter frame */
.card-grid.carousel.base-card-grid .card {
  min-width: clamp(120px, 36vw, 192px);
  max-width: clamp(120px, 36vw, 192px);
  min-height: 144px;
}
/* Modifier cards: slightly narrower to fit more copy */
.card-grid.carousel.mod-card-grid .card {
  min-width: clamp(260px, 78vw, 380px);
  max-width: clamp(260px, 78vw, 380px);
}
@media (max-width: 768px) {
  .card-grid.carousel .card {
    min-width: 94%;
    max-width: 94%;
  }
}

.card-grid.carousel::-webkit-scrollbar {
  height: 8px;
}
.card-grid.carousel::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.14);
  border-radius: 999px;
}

/* cHUD overlay */
.chud-fab {
  display: none;
}
.chud-overlay {
  position: fixed;
  inset: 0;
  background: rgba(4,6,10,0.72);
  backdrop-filter: blur(12px);
  z-index: 400;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 16px 14px 14px;
}
.chud-sheet {
  width: min(960px, 100%);
  background: #0c0f16;
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  display: flex;
  flex-direction: column;
  max-height: 96vh;
}
.chud-sheet-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  font-weight: 800;
}
.chud-close {
  border: 1px solid rgba(255,255,255,0.2);
  background: rgba(255,255,255,0.06);
  color: #eaf2ff;
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 0.95rem;
}
.chud-sheet-body {
  flex: 1;
  min-height: 80vh;
  height: 80vh;
  overflow: hidden;
}
.chud-sheet-body iframe {
  width: 100%;
  height: 100%;
  display: block;
  border: none;
}
@media (max-width: 768px) {
  .chud-sheet { max-height: 96vh; }
  .chud-sheet-body { min-height: 78vh; height: 78vh; }
}

.play-overlay-mod { display:flex; justify-content: space-between; align-items:center; gap:8px; padding:4px 0; }
.play-attach-pill { padding:2px 8px; border-radius:999px; background: var(--accent); color:#000; font-weight:700; font-size:0.75rem; }

.play-overlay-mod-name { font-weight: 700; color: #fff; text-shadow: 0 0 12px rgba(0,255,200,0.45); }

.hand-actions-left,
.hand-actions-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

.hand-card.attached-mod {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px var(--accent), 0 12px 26px rgba(0, 255, 200, 0.4), inset 0 0 10px rgba(0, 255, 200, 0.2);
}
.hand-card.selected-base {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px var(--accent), 0 14px 28px rgba(0, 255, 200, 0.4), inset 0 0 12px rgba(0, 255, 200, 0.25);
}

/* Hand card underglow by type */
.hand-card.base-type {
  box-shadow:
    0 12px 28px rgba(123, 120, 255, 0.22),
    0 0 0 1px rgba(123, 120, 255, 0.3),
    0 0 18px rgba(123, 120, 255, 0.22);
}
.hand-card.mod-type {
  box-shadow:
    0 12px 28px rgba(0, 255, 200, 0.18),
    0 0 0 1px rgba(0, 255, 200, 0.25),
    0 0 18px rgba(0, 255, 200, 0.18);
}
.hand-card.null-type {
  box-shadow:
    0 12px 28px rgba(255, 215, 96, 0.2),
    0 0 0 1px rgba(255, 215, 96, 0.28),
    0 0 18px rgba(255, 215, 96, 0.2);
}

.hand-card-header { padding-top: 4px; padding-inline: 4px; }

.hand-actions button {
  white-space: nowrap;
}

.hand-actions-inline { justify-content: space-between; }

.hand-nav {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-top: 10px;
}
.hand-nav button {
  min-width: 36px;
  height: 32px;
  padding: 0 10px;
}
.hand-nav-with-count {
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 12px;
}
.hand-count-inline {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: var(--type-body);
}

/* Compact discard list */
.discard-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 10px;
}
.discard-row {
  display: flex;
  align-items: center;
  gap: 10px;
  justify-content: space-between;
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--surface);
}
.discard-name { font-weight: 600; }
.discard-actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}
.discard-actions .counter-btn { padding: 6px 10px; min-width: 56px; }
.discard-count { font-weight: 700; color: var(--accent); }

/* Default skill grid */
.card-grid.base-card-grid.skill-grid {
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  justify-items: center;
}

/* Deck builder: locked 95px skill grid */
.card-grid.base-card-grid.skill-grid.deck-builder-skill-grid {
  grid-template-columns: repeat(3, 95px) !important;
  grid-template-rows: repeat(5, 95px);
  grid-auto-flow: column;
  grid-auto-columns: 95px;
  grid-auto-rows: 95px;
  justify-content: center;
  justify-items: center;
  column-gap: 10px;
  row-gap: 10px;
}
.card-grid.base-card-grid.skill-grid.deck-builder-skill-grid .card {
  width: 95px;
  min-width: 95px;
  max-width: 95px;
  height: 95px;
  min-height: 95px;
  max-height: 95px;
  padding: 6px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
  gap: 6px;
  box-shadow:
    0 0 28px rgba(90, 180, 255, 0.75),
    0 12px 30px rgba(0, 0, 0, 0.38),
    0 0 0 1px rgba(120, 190, 255, 0.75),
    inset 0 0 0 1px rgba(120, 190, 255, 0.32);
  border: 1px solid rgba(120, 190, 255, 0.75);
  background: radial-gradient(circle at 40% 30%, rgba(120, 180, 255, 0.28), rgba(11, 14, 20, 0.9) 58%), #0b0e14;
}
.card-grid.base-card-grid.skill-grid.deck-builder-skill-grid .card .card-header {
  display: flex;
  flex-direction: column;
  width: 100%;
  align-items: flex-start !important;
  justify-content: flex-start !important;
  gap: 10px;
  text-align: left !important;
}
.card-grid.base-card-grid.skill-grid.deck-builder-skill-grid .card .card-title {
  display: flex;
  flex-direction: column;
  width: 100%;
  align-items: flex-start !important;
  justify-content: flex-start !important;
  text-align: left !important;
  gap: 10px;
}
.card-grid.base-card-grid.skill-grid.deck-builder-skill-grid .card .card-name {
  width: 100%;
  text-align: left !important;
  white-space: normal;
  word-break: break-word;
  overflow: visible;
  text-overflow: clip;
  font-size: clamp(0.62rem, 1.9vw, 0.82rem);
  line-height: 1.05;
  padding-left: 0;
}
.card-grid.base-card-grid.skill-grid.deck-builder-skill-grid .card .counter-value.counter-pill {
  width: 100% !important;
  max-width: 100% !important;
  display: flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
  text-align: left !important;
  font-size: clamp(1.14rem, 2.86vw, 1.43rem);
  padding: 10px 12px;
  box-sizing: border-box;
  align-self: flex-start !important;
  margin-left: 0 !important;
  padding-left: 0;
}
